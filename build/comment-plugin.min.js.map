{"version":3,"file":"comment-plugin.min.js","sources":["../src/draggable.js","../src/comment.js","../src/utils.js","../src/frame-comment.js","../src/inline-comment.js","../src/manager.js","../src/index.js"],"sourcesContent":["export default class Draggable {\n\n    constructor(el, onStart = () => {}, onTranslate = () => {}, onDrag = () => {}) {\n        this.mouseStart = null;\n\n        this.el = el;\n        this.onStart = onStart;\n        this.onTranslate = onTranslate;\n        this.onDrag = onDrag;\n\n        this.initEvents(el);\n    }\n\n    initEvents(el) {\n        el.addEventListener('pointerdown', this.down.bind(this));\n        window.addEventListener('pointermove', this.move.bind(this));\n        window.addEventListener('pointerup', this.up.bind(this));\n    }\n\n    getCoords(e) {\n        const props = e.touches ? e.touches[0] : e;\n\n        return [props.pageX, props.pageY];\n    }\n\n    down(e) {\n        e.stopPropagation();\n        this.mouseStart = this.getCoords(e);\n\n        this.onStart();\n    }\n\n    move(e) {\n        if (!this.mouseStart) return;\n        e.preventDefault();\n        e.stopPropagation();\n\n        let [x, y] = this.getCoords(e);\n        let delta = [x - this.mouseStart[0], y - this.mouseStart[1]];\n        let zoom = this.el.getBoundingClientRect().width / this.el.offsetWidth;\n\n        this.onTranslate(delta[0] / zoom, delta[1] / zoom);\n    }\n\n    up() {\n        if (this.mouseStart) {\n            this.onDrag();\n        }\n\n        this.mouseStart = null;\n    }\n}","import Draggable from './draggable';\n\nexport default class Comment {\n    constructor(text, editor) {\n        this.editor = editor;\n        this.text = text;\n        this.scale = 1;\n        this.x = 0;\n        this.y = 0;\n        this.dragPosition = [0, 0];\n        this.links = [];\n \n        this.initView();\n        this.update();\n    }\n\n    initView() {\n        this.el = document.createElement('div');\n        this.el.tabIndex = 1;\n        this.el.addEventListener('contextmenu', this.onContextMenu.bind(this));\n        this.el.addEventListener('focus', this.onFocus.bind(this));\n        this.el.addEventListener('blur', this.onBlur.bind(this));\n    \n        new Draggable(this.el, () => this.onStart(), (dx, dy) => this.onTranslate(dx, dy));\n    }\n\n    linkTo(ids) {\n        this.links = ids || [];\n    }\n\n    linkedTo(node) {\n        return this.links.includes(node.id);\n    }\n\n    k() {\n        return 1;\n    }\n\n    onContextMenu(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this.editor.trigger('editcomment', this);\n    }\n\n    onFocus() {\n        this.scale = Math.max(1, 1 / this.k());\n        this.update();\n        this.editor.trigger('commentselected', this)\n    }\n\n    focused() {\n        return document.activeElement === this.el;\n    }\n\n    onBlur() {\n        this.scale = 1;\n        this.update()\n    }\n\n    blur() {\n        this.el.blur();\n    }\n\n    onStart() {\n        this.dragPosition = [this.x, this.y];\n    }\n\n    onTranslate (dx, dy) {\n        const [x, y] = this.dragPosition;\n\n        this.x = x + this.scale * dx;\n        this.y = y + this.scale * dy;\n        \n        this.update();\n    }\n\n    update() {\n        this.el.innerText = this.text;\n        this.el.style.transform = `translate(${this.x}px, ${this.y}px) scale(${this.scale})`;\n    }\n\n    toJSON() {\n        return {\n            text: this.text,\n            position: [ this.x, this.y ],\n            links: this.links\n        }\n    }\n}","const min = (arr) => arr.length === 0 ? 0 : Math.min(...arr);\nconst max = (arr) => arr.length === 0 ? 0 : Math.max(...arr);\n\nexport function intersectRect(r1, r2) {\n    return !(\n        r2.left > r1.right || \n        r2.right < r1.left || \n        r2.top > r1.bottom ||\n        r2.bottom < r1.top\n    );\n}\n\nexport function containsRect(r1, r2) {\n    return (\n        r2.left > r1.left && \n        r2.right < r1.right && \n        r2.top > r1.top &&\n        r2.bottom < r1.bottom\n    );\n}\n\nexport function nodesBBox(editor, nodes, margin) {\n    const left = min(nodes.map(node => node.position[0])) - margin;\n    const top = min(nodes.map(node => node.position[1])) - margin;\n    const right = max(nodes.map(node => node.position[0] + editor.view.nodes.get(node).el.clientWidth)) + 2 * margin;\n    const bottom = max(nodes.map(node => node.position[1] + editor.view.nodes.get(node).el.clientHeight)) + 2 * margin;\n    \n    return {\n        left,\n        right,\n        top,\n        bottom,\n        width: Math.abs(left - right),\n        height: Math.abs(top - bottom),\n        getCenter: () => {\n            return [\n                (left + right) / 2,\n                (top + bottom) / 2\n            ];\n        }\n    };\n}","import Comment from './comment';\nimport { containsRect } from './utils';\n\nexport default class FrameComment extends Comment {\n    constructor(text, editor) {\n        super(text, editor);\n        \n        this.width = 0;\n        this.height = 0;\n        this.links = [];\n        this.el.className = 'frame-comment';\n        this.el.title = text;\n    }\n\n    linkedNodesView() {\n        return this.links\n            .map(id => this.editor.nodes.find(n => n.id === id))\n            .map(node => this.editor.view.nodes.get(node));\n    }\n\n    onStart() {\n        super.onStart();\n        this.linkedNodesView().map(nodeView => nodeView.onStart())\n    }\n\n    onTranslate(dx, dy) {\n        super.onTranslate(dx, dy);\n        this.linkedNodesView().map(nodeView => nodeView.onDrag(dx, dy))\n    }\n\n    isContains(node) {\n        const commRect = this.el.getBoundingClientRect();\n        const view = this.editor.view.nodes.get(node);\n    \n        return containsRect(commRect, view.el.getBoundingClientRect());\n    }\n\n    update() {\n        super.update();\n\n        this.el.style.width = this.width+'px';\n        this.el.style.height = this.height+'px';\n    }\n\n    toJSON() {\n        return {\n            ...super.toJSON(),\n            type: 'frame',\n            width: this.width,\n            height: this.height\n        }\n    }\n}","import Comment from './comment';\nimport { intersectRect } from './utils';\n\nexport default class InlineComment extends Comment {\n    constructor(text, editor) {\n        super(text, editor);\n        \n        this.el.className = 'inline-comment';\n        this.el.addEventListener('mouseup', this.onDrag.bind(this));\n    }\n\n    onDrag() {\n        const intersection = this.getIntersectNode();\n\n        this.linkTo(intersection ? [intersection.node.id] : []);\n    }\n\n    getIntersectNode() {\n        const commRect = this.el.getBoundingClientRect();\n\n        return Array.from(this.editor.view.nodes)\n            .map(([node, view]) => {\n                return { node, rect: view.el.getBoundingClientRect() };\n            })\n            .find(({ rect }) => {\n                return intersectRect(commRect, rect);\n            });\n    }\n\n    offset(dx, dy) {\n        this.x += dx;\n        this.y += dy;\n        this.update();\n    } \n\n    toJSON() {\n        return {\n            ...super.toJSON(),\n            type: 'inline'\n        }\n    }\n}","import FrameComment from './frame-comment';\nimport InlineComment from './inline-comment';\n\nexport default class CommentManager {\n    constructor(editor) {\n        this.editor = editor;\n        this.comments = [];\n\n        editor.on('zoomed', () => {\n            this.comments.map(c => c.blur.call(c));\n        });\n    }\n\n    addInlineComment(text, [ x, y ], links = []) {\n        let comment = new InlineComment(text, this.editor);\n\n        comment.k = () => this.editor.view.area.transform.k;\n        comment.x = x;\n        comment.y = y;\n        comment.linkTo(links);\n\n        this.addComment(comment);\n    }\n\n    addFrameComment(text, [ x, y ], links = [], width = 0, height = 0) {\n        let comment = new FrameComment(text, this.editor);\n\n        comment.x = x;\n        comment.y = y;\n        comment.width = width;\n        comment.height = height;\n        comment.linkTo(links);\n        \n        this.addComment(comment);\n    }\n\n    addComment(comment) {\n        comment.update();\n        this.comments.push(comment);\n\n        this.editor.view.area.appendChild(comment.el);\n        this.editor.trigger('commentcreated', comment);\n    }\n\n    deleteComment(comment) {\n        this.editor.view.area.removeChild(comment.el);\n        this.comments.splice(this.comments.indexOf(comment), 1);\n\n        this.editor.trigger('commentremoved', comment);\n    }\n\n    deleteFocusedComment() {\n        const focused = this.comments.find(c => c.focused());\n        \n        if (focused)\n            this.deleteComment(focused)\n    }\n\n    deleteComments() {\n        [...this.comments].map(c => this.deleteComment(c));\n    }\n\n    toJSON() {\n        return this.comments.map(c => c.toJSON())\n    }\n\n    fromJSON(list) {\n        this.deleteComments();\n        list.map(item => {\n            if (item.type === 'frame') {\n                this.addFrameComment(item.text, item.position, item.links, item.width, item.height)\n            } else {\n                this.addInlineComment(item.text, item.position, item.links);\n            }\n        });\n    }\n}","import './style.sass';\nimport CommentManager from './manager';\nimport FrameComment from './frame-comment';\nimport InlineComment from './inline-comment';\nimport { nodesBBox } from './utils';\n\n// eslint-disable-next-line max-statements\nfunction install(editor, { margin = 30, disableBuiltInEdit = false }) {\n    editor.bind('commentselected');\n    editor.bind('commentcreated');\n    editor.bind('commentremoved');\n    editor.bind('syncframes');\n    editor.bind('addcomment');\n    editor.bind('removecomment');\n    editor.bind('editcomment');\n\n    const manager = new CommentManager(editor);\n\n    if (!disableBuiltInEdit) { \n        editor.on('editcomment', (comment) => {\n            comment.text = prompt('Edit comment', comment.text)\n            comment.update();\n        });\n    }\n\n    function handleKey(e) {\n        if (e.code === 'KeyF' && e.shiftKey) {\n            const ids = editor.selected.list.map(node => node.id);\n            const nodes = ids.map(id => editor.nodes.find(n => n.id === id));\n    \n            editor.trigger('addcomment', ({ type: 'frame', nodes }))\n        } else if (e.code === 'KeyC' && e.shiftKey) {\n            const position = Object.values(editor.view.area.mouse);\n\n            editor.trigger('addcomment', ({ type: 'inline', position }))\n        } else if (e.code === 'Delete') {\n            manager.deleteFocusedComment();\n        }\n    }\n\n    window.addEventListener('keydown', handleKey);\n    editor.on('destroy', () => window.removeEventListener('keydown', handleKey));\n\n    editor.on('addcomment', ({ type, text, nodes, position }) => {\n        if (type === 'inline') {\n            manager.addInlineComment(text, position);\n        } else if (type === 'frame') {\n            const { left, top, width, height } = nodesBBox(editor, nodes, margin);\n            const ids = nodes.map(n => n.id);\n        \n            manager.addFrameComment(text, position || [ left, top ], ids, width, height);\n        } else {\n            throw new Error(`type '${type}' not supported`);\n        }\n    })\n\n    editor.on('removecomment', ({ comment, type }) => {\n        if (comment) {\n            manager.deleteComment(comment)\n        } else if (type === 'inline') {\n            manager.comments\n                .filter(c => c instanceof InlineComment)\n                .map(c => manager.deleteComment(c))\n        } else if (type === 'frame') {\n            manager.comments\n                .filter(c => c instanceof FrameComment)\n                .map(c => manager.deleteComment(c))\n        }\n    });\n\n    editor.on('syncframes', () => {\n        manager.comments\n            .filter(comment => comment instanceof FrameComment)\n            .map(comment => {\n                const nodes = comment.links.map(id => editor.nodes.find(n => n.id === id));\n                const { left, top, width, height } = nodesBBox(editor, nodes, margin);\n\n                comment.x = left;\n                comment.y = top;\n                comment.width = width;\n                comment.height = height;\n                \n                comment.update()\n            });\n    })\n\n    editor.on('nodetranslated', ({ node, prev }) => {\n        const dx = node.position[0] - prev[0];\n        const dy = node.position[1] - prev[1];\n\n        manager.comments\n            .filter(comment => comment instanceof InlineComment)\n            .filter(comment => comment.linkedTo(node))\n            .map(comment => comment.offset(dx, dy));\n    });\n\n    editor.on('nodedraged', node => {\n        manager.comments\n            .filter(comment => comment instanceof FrameComment)\n            .filter(comment => {\n                const contains = comment.isContains(node);\n                const links = comment.links.filter(id => id !== node.id);\n\n                comment.links = contains ? [...links, node.id] : links;\n            });\n    });\n\n    editor.on('commentselected', () => {\n        const list = [...editor.selected.list];\n\n        editor.selected.clear();\n        list.map(node => node.update ? node.update() : null);\n    })\n\n    editor.on('export', data => {\n        data.comments = manager.toJSON();\n    });\n\n    editor.on('import', data => {\n        manager.fromJSON(data.comments || []);\n    });\n\n    if (editor.exist('clear')) { // compatibility with previous versions\n        editor.on('clear', () => manager.deleteComments())\n    }\n}\n\nexport default {\n    name: 'comment',\n    install\n}"],"names":["Draggable","el","onStart","onTranslate","onDrag","mouseStart","initEvents","addEventListener","this","down","bind","window","move","up","e","props","touches","pageX","pageY","stopPropagation","getCoords","preventDefault","x","y","delta","zoom","getBoundingClientRect","width","offsetWidth","Comment","text","editor","scale","dragPosition","links","initView","update","document","createElement","tabIndex","onContextMenu","onFocus","onBlur","_this","dx","dy","ids","node","includes","id","trigger","Math","max","k","activeElement","blur","innerText","style","transform","position","min","arr","length","nodesBBox","nodes","margin","left","map","top","right","view","get","clientWidth","bottom","clientHeight","abs","height","getCenter","FrameComment","className","title","_this2","find","n","linkedNodesView","nodeView","r1","r2","commRect","type","InlineComment","intersection","getIntersectNode","linkTo","Array","from","rect","CommentManager","comments","on","c","call","comment","area","addComment","push","appendChild","removeChild","splice","indexOf","focused","deleteComment","_this3","toJSON","list","deleteComments","item","_this4","addFrameComment","addInlineComment","name","install","disableBuiltInEdit","manager","handleKey","code","shiftKey","selected","Object","values","mouse","deleteFocusedComment","prompt","removeEventListener","Error","filter","prev","linkedTo","offset","contains","isContains","clear","data","fromJSON","exist"],"mappings":"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"}